-- BÀI TẬP THỰC HÀNH CSDL VỀ QUẢN KÝ GIÁO VỤ 
DROP DATABASE QLGVB-- delete 
-- XÓA BẢNG 
DROP TABLE KHOA
DROP TABLE MONHOC 
DROP TABLE DIEUKIEN
DROP TABLE GIAOVIEN
DROP TABLE LOP
DROP TABLE HOCVIEN
DROP TABLE GIANGDAY
DROP TABLE KETQUATHI

CREATE DATABASE QLGV
USE QLGV

CREATE TABLE KHOA(
	MAKHOA VARCHAR(4),
	TENKHOA NVARCHAR(40),
	NGTLAP SMALLDATETIME,
	TRGKHOA CHAR(4),
	PRIMARY KEY(MAKHOA)
)

CREATE TABLE MONHOC(
	MAMH VARCHAR(10),
	TENMH NVARCHAR(40),
	TCLT TINYINT,
	TCTH TINYINT,
	MAKHOA VARCHAR(4),
	PRIMARY KEY(MAMH)
)

CREATE TABLE DIEUKIEN(
	MAMH VARCHAR(10),
	MAMH_TRUOC VARCHAR(10),
	PRIMARY KEY(MAMH,MAMH_TRUOC)
)

CREATE TABLE GIAOVIEN(
	MAGV CHAR(4),
	HOTEN NVARCHAR(40),
	HOCVI NVARCHAR(10),
	HOCHAM NVARCHAR(10),
	GIOITINH NVARCHAR(3),
	NGSINH SMALLDATETIME,
	NGVL SMALLDATETIME,
	HESO NUMERIC(4,2),
	MUCLUONG MONEY,
	MAKHOA VARCHAR(4),
	PRIMARY KEY(MAGV)
)

CREATE TABLE LOP(
	MALOP CHAR(3),
	TENLOP NVARCHAR(40),
	TRGLOP CHAR(5),
	SISO TINYINT,
	MAGVCN CHAR(4),
	PRIMARY KEY(MALOP)
)

CREATE TABLE HOCVIEN(
	MAHV CHAR(5),
	HO NVARCHAR(40),
	TEN NVARCHAR(10),
	NGSINH SMALLDATETIME,
	GIOITINH NVARCHAR(3),
	NOISINH NVARCHAR(40),
	MALOP CHAR(3),
	PRIMARY KEY(MAHV)
)

CREATE TABLE GIANGDAY(
	MALOP CHAR(3),
	MAMH VARCHAR(10),
	MAGV CHAR(4),
	HOCKY TINYINT,
	NAM SMALLINT,
	TUNGAY SMALLDATETIME,
	DENNGAY SMALLDATETIME,
	PRIMARY KEY(MAMH, MALOP)
)

CREATE TABLE KETQUATHI(
	MAHV CHAR(5),
	MAMH VARCHAR(10),
	LANTHI TINYINT,
	NGTHI SMALLDATETIME,
	DIEM NUMERIC(4,2),
	KQUA NVARCHAR(10),
	PRIMARY KEY(MAMH,MAHV,LANTHI)
)

--------------------------------------------------------------------------------------------------------------------------
--I> NGÔN NGỮ ĐỊNH NGHĨA DỮ LIỆU (DATA DEFINITION LANGUAGE):

--1>  Tạo quan hệ và khai báo tất cả các ràng buộc khóa chính, khóa ngoại.
ALTER TABLE KHOA 
ADD CONSTRAINT FK_KHOA_TRGKHOA FOREIGN KEY(TRGKHOA) REFERENCES GIAOVIEN(MAGV) 

ALTER TABLE MONHOC
ADD CONSTRAINT FK_MONHOC_MAKHOA FOREIGN KEY(MAKHOA) REFERENCES KHOA(MAKHOA)

ALTER TABLE DIEUKIEN
ADD CONSTRAINT FK_DIEUKIEN_MAMH FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH)

ALTER TABLE DIEUKIEN
ADD CONSTRAINT FK_DIEUKIEN_MAMH_TRUOC FOREIGN KEY(MAMH_TRUOC) REFERENCES MONHOC(MAMH)

ALTER TABLE GIAOVIEN 
ADD CONSTRAINT FK_GIAOVIEN_MAKHOA FOREIGN KEY(MAKHOA) REFERENCES KHOA(MAKHOA)

ALTER TABLE LOP
ADD CONSTRAINT FK_LOP_TRGLOP FOREIGN KEY(TRGLOP) REFERENCES HOCVIEN(MAHV)

ALTER TABLE LOP
ADD CONSTRAINT FK_LOP_MAGVCN FOREIGN KEY(MAGVCN) REFERENCES GIAOVIEN(MAGV)

ALTER TABLE HOCVIEN
ADD CONSTRAINT FK_HOCVIEN_MALOP FOREIGN KEY(MALOP) REFERENCES LOP(MALOP)

ALTER TABLE GIANGDAY
ADD CONSTRAINT FK_GIANGDAY_MALOP FOREIGN KEY(MALOP) REFERENCES LOP(MALOP)

ALTER TABLE GIANGDAY
ADD CONSTRAINT FK_GIANGDAY_MAMH FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH)

ALTER TABLE GIANGDAY
ADD CONSTRAINT FK_GIANGDAY_MAGV FOREIGN KEY(MAGV) REFERENCES GIAOVIEN(MAGV)

ALTER TABLE KETQUATHI 
ADD CONSTRAINT FK_KETQUATHI_MAHV FOREIGN KEY(MAHV) REFERENCES HOCVIEN(MAHV)

ALTER TABLE KETQUATHI
ADD CONSTRAINT FK_KETQUATHI_MAMH FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH)

--Thêm vào 3 thuộc tính GHICHU, DIEMTB, XEPLOAI cho quan hệ HOCVIEN.
ALTER TABLE HOCVIEN ADD 
	GHICHU NVARCHAR(40),
	DIEMTB NUMERIC(4,2),
	XEPLOAI NVARCHAR(10)

--2> Mã học viên là một chuỗi 5 ký tự, 3 ký tự đầu là mã lớp.
--   2 ký tự cuối cùng là số thứ tự học viên trong lớp.
ALTER TABLE HOCVIEN 
ADD CONSTRAINT CHK_MAHV CHECK(SUBSTRING(MAHV, 1,3) = MALOP 
	AND (ISNUMERIC(SUBSTRING(MAHV, 4,2)) = 1 ) 
	AND SUBSTRING(MAHV, 1,5) = MAHV) 

--3>Thuộc tính GIOITINH chỉ có giá trị là “Nam” hoặc “Nữ”.
ALTER TABLE HOCVIEN
ADD CONSTRAINT CHK_GIOITINH CHECK(GIOITINH IN ('Nam', N'Nữ'))

ALTER TABLE GIAOVIEN
ADD CONSTRAINT CHK_GIOITINHGV CHECK(GIOITINH IN ('Nam', N'Nữ'))
--4> Điểm số của một lần thi có giá trị từ 0 đến 10 và cần lưu đến 2 số lẽ
ALTER TABLE KETQUATHI 
ADD CONSTRAINT CHK_DIEM CHECK(DIEM <=10 AND DIEM >=0)

--5> Kết quả thi là “Dat” nếu điểm từ 5 đến 10 và “Khong dat” nếu điểm nhỏ hơn 5
--BANG KETQUATHI
ALTER TABLE KETQUATHI
ADD CONSTRAINT CHK_KQTHI_DIEM_KETQUATHI CHECK ((DIEM >= 5 AND DIEM <= 10 AND KQUA = N'Đạt') 
										    OR (DIEM >= 0 AND DIEM < 5   AND KQUA = N'Không Đạt'))

--6> Học viên thi một môn tối đa 3 lần
--BANG KETQUATHI 
ALTER TABLE KETQUATHI 
ADD CONSTRAINT CHK_LANTHI_KETQUATHI CHECK (LANTHI < 4 AND LANTHI >= 0) 

--7> Học kỳ chỉ có giá trị từ 1 đến 3.
--BANG GIANGDAY 
ALTER TABLE GIANGDAY
ADD CONSTRAINT CHK_HOCKY_GIANGDAY CHECK ( HOCKY >=1 AND HOCKY <=3)

--8> Học vị của giáo viên chỉ có thể là “CN”, “KS”, “Ths”, ”TS”, ”PTS”
--BANG GIAOVIEN 
ALTER TABLE GIAOVIEN 
ADD CONSTRAINT CHK_GIAOVIEN_HOCVI CHECK (HOCVI IN ('CN','KS','Ths','TS','PTS'))

--9> Lớp trưởng của một lớp phải là học viên của lớp đó.
--TRIGGER 
--BANG LOP, HOCVIEN
CREATE TRIGGER INSERT_LOP_TRUONG 
ON LOP 
FOR INSERT 
AS 
BEGIN 
	DECLARE @TRGLOP CHAR(5), @MALOP CHAR(3), @MAHV CHAR(5) 

	SELECT @TRGLOP = TRGLOP, @MALOP = MALOP 
	FROM INSERTED 

	SELECT @MAHV = MAHV 
	FROM HOCVIEN 
	WHERE MAHV = @TRGLOP AND MALOP = @MALOP 

	IF (@MAHV <> @TRGLOP) 
		BEGIN 
			PRINT(N'Lỗi');
			ROLLBACK TRANSACTION 
		END 
	ELSE 
		PRINT 'OK' 
END

--10> Trưởng khoa phải là giáo viên thuộc khoa và có học vị “TS” hoặc “PTS”.
--TRIGGER 
--BANG KHOA, GIAOVIEN 
CREATE TRIGGER INSERT_TRUONG_KHOA
ON KHOA 
FOR INSERT
AS 
BEGIN
	DECLARE @TRGKHOA CHAR(5), @MAKHOA VARCHAR(4), @MAGV CHAR(4)

	SELECT @TRGKHOA = TRGKHOA, @MAKHOA = MAKHOA 
	FROM INSERTED 

	SELECT @MAGV = MAGV 
	FROM GIAOVIEN 
	WHERE MAGV = @TRGKHOA AND @MAKHOA = MAKHOA AND HOCVI IN ('TS', 'PTS') 

	IF (@TRGKHOA <> @MAGV) 
		BEGIN 
			PRINT(N'Lỗi');
			ROLLBACK TRANSACTION 
		END 
	ELSE 
		PRINT 'OK' 
END

--11>  Học viên ít nhất là 18 tuổi.
--BANG HOCVIEN
ALTER TABLE HOCVIEN
ADD CONSTRAINT CHK_HOCVIEN_KTNGSINH CHECK ( YEAR(GETDATE()) - YEAR(NGSINH)>=18)

--12> Giảng dạy một môn học ngày bắt đầu (TUNGAY) phải nhỏ hơn ngày kết thúc (DENNGAY).
--BANG GIANGDAY
ALTER TABLE GIANGDAY
ADD CONSTRAINT CHK_GIANGDAY_THOIGIANGD CHECK (TUNGAY < DENNGAY)

--13>  Giáo viên khi vào làm ít nhất là 22 tuổi.
--BANG GIAOVIEN
ALTER TABLE GIAOVIEN 
ADD CONSTRAINT CHK_GIAOVIEN_NGVL CHECK ( YEAR(NGVL) - YEAR(NGSINH) >=22)

--14> Tất cả các môn học đều có số tín chỉ lý thuyết và tín chỉ thực hành chênh lệch nhau không quá 3.
-- BANG MONHOC 

ALTER TABLE MONHOC 
ADD CONSTRAINT CHK_MONHOC_CHENHLECH CHECK ( ABS(TCLT-TCTH) <=3 )

--15> Học viên chỉ được thi một môn học nào đó khi lớp của học viên đã học xong môn học này
-- TRIGGER 
--BANG KETQUATHI, GIANGDAY 
CREATE TRIGGER INSERT_NGAYTHI 
ON KETQUATHI 
FOR INSERT,UPDATE 
AS 
BEGIN
	DECLARE @MAHV CHAR(5), @NGTHI SMALLDATETIME , @MAMH VARCHAR(10) , @MALOP CHAR(3), @DENNGAY SMALLDATETIME

	SELECT @MAHV = MAHV, @MAMH = MAMH, @NGTHI = NGTHI 
	FROM INSERTED 

	SELECT @MALOP = MALOP, @DENNGAY = DENNGAY 
	FROM GIANGDAY  
	WHERE SUBSTRING(@MAHV, 1,3) = @MALOP AND MAMH = @MAMH

	IF (@DENNGAY > @NGTHI) 
		BEGIN 
			PRINT(N'Lỗi');
			ROLLBACK TRANSACTION 
		END 
	ELSE 
		PRINT 'OK' 
END

--16> Mỗi học kỳ của một năm học, một lớp chỉ được học tối đa 3 môn.
-- BANG GIANGDAY 

INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11','PTTKHTTT'  ,'GV07',1,2006,'2006/1/2' ,'2006/5/12' )

CREATE TRIGGER INSERT_TOIDA3MON
ON GIANGDAY
FOR INSERT, UPDATE  
AS
BEGIN 
	DECLARE @SOLUONG TINYINT 

	SELECT @SOLUONG = COUNT(DISTINCT MAMH) 
	FROM INSERTED  
	GROUP BY HOCKY, NAM, MALOP 
	
	IF (@SOLUONG > 3) 
		BEGIN 
			PRINT(N'Lỗi');
			ROLLBACK TRANSACTION 
		END 
	ELSE 
		PRINT 'OK' 
END 

--17> Sỉ số của một lớp bằng với số lượng học viên thuộc lớp đó.
--TRIGGER 
--BANG LOP, HOCVIEN 
CREATE TRIGGER INSERT_SISOLOP
ON LOP
FOR INSERT , UPDATE  
AS 
BEGIN 
	DECLARE @SISO TINYINT, @SOLUONG TINYINT,@MALOP CHAR(4)

	SELECT @SISO = SISO, @MALOP = MALOP 
	FROM INSERTED 

	SELECT @SOLUONG = COUNT(MAHV) 
	FROM HOCVIEN 
	WHERE MALOP = @MALOP 
	GROUP BY MALOP 

	IF(@SOLUONG<>@SISO)
		BEGIN
			PRINT(N'Lỗi');
			ROLLBACK TRANSACTION 
		END
	ELSE 
		PRINT 'OK' 
END 
--18> Trong quan hệ DIEUKIEN giá trị của thuộc tính MAMH và MAMH_TRUOC trong cùng 
--một bộ không được giống nhau (“A”,”A”) và cũng không tồn tại hai bộ (“A”,”B”) và 
--(“B”,”A”).
-- BANG DIEUKIEN 
INSERT INTO DIEUKIEN(MAMH, MAMH_TRUOC) VALUES ('CTRR'    , 'CSDL'  )
INSERT INTO DIEUKIEN(MAMH, MAMH_TRUOC) VALUES ('CSDL'    , 'CSDL'  )
SELECT*
FROM DIEUKIEN 

CREATE TRIGGER INSERT_DIEUKIENMONHOC 
ON DIEUKIEN  
FOR INSERT 
AS 
BEGIN
	DECLARE @MAMH1 CHAR(10), @MAMH_TRUOC1 CHAR(10),@MAMH2 CHAR(10), @MAMH_TRUOC2 CHAR(10)

	SELECT @MAMH1 = MAMH, @MAMH_TRUOC1 = MAMH_TRUOC
	FROM inserted
	
	SELECT @MAMH2 = MAMH, @MAMH_TRUOC2 = MAMH_TRUOC 
	FROM DIEUKIEN
	WHERE MAMH = @MAMH_TRUOC1
		
	IF(@MAMH1 = @MAMH_TRUOC1 OR @MAMH_TRUOC2 = @MAMH1 )
		BEGIN 
			PRINT(N'Lỗi');
			ROLLBACK TRANSACTION 
		END 
	ELSE 
		PRINT 'OK'	
END

--19> Các giáo viên có cùng học vị, học hàm, hệ số lương thì mức lương bằng nhau
 -- 2 BANG GIAOVIEN 
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV99', N'Hồ Thanh SơnAAA'	,'PTS', 'GS'  , N'Nam', '1950/5/2'  , '2004/1/11', 5.20, 22500000, 'KHMT')
SELECT*
FROM GIAOVIEN 
DELETE FROM GIAOVIEN 
WHERE MAGV = 'GV99' 
DROP TRIGGER INSERT_GIAOVIENMUCLUONG

CREATE TRIGGER INSERT_GIAOVIENMUCLUONG
ON GIAOVIEN   
FOR INSERT
AS 
BEGIN
	DECLARE @HOCVI VARCHAR(10), @HOCHAM VARCHAR(10), @HESO NUMERIC(4,2), @MUCLUONG1 MONEY, @MUCLUONG2 MONEY 

	SELECT @HOCVI = HOCVI, @HOCHAM = HOCHAM, @HESO = HESO, @MUCLUONG1 = MUCLUONG
	FROM inserted
	
	SELECT @MUCLUONG2 = MUCLUONG 
	FROM GIAOVIEN 
	WHERE HOCVI = @HOCVI AND HESO = @HESO AND HOCHAM = @HOCHAM 
		
	IF(@MUCLUONG1 <> @MUCLUONG2)
		BEGIN 
			PRINT(N'Lỗi');
			ROLLBACK TRANSACTION 
		END 
	ELSE 
		PRINT 'OK'	
END

--20> Học viên chỉ được thi lại (lần thi > 1) khi điểm của lần thi trước đó dưới 5.


--21> Ngày thi của lần thi sau phải lớn hơn ngày thi của lần thi trước (cùng học viên, cùng môn học).


--22> Học viên chỉ được thi những môn mà lớp của học viên đó đã học xong.


--23> Khi phân công giảng dạy một môn học, phải xét đến thứ tự trước sau giữa các môn học (sau 
--khi học xong những môn học phải học trước mới được học những môn liền sau).


--24> Giáo viên chỉ được phân công dạy những môn thuộc khoa giáo viên đó phụ trách.
-- BANG GIAOVIEN, GIANGDAY, KHOA, MONHOC 
--------------------------------------------------------------------------------------------------------------------------

-- INSERT 8 BẢNG DỮ LIỆU TIẾNG VIỆT 
--SET DATEFORMAT DMY -- ngày/tháng/năm 
INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) VALUES ('KHMT', N'Khoa học máy tính'			   ,'2005/6/7'  )
INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) VALUES ('HTTT', N'Hệ thống thông tin'		   ,'2005/6/7'  )
INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) VALUES ('CNPM', N'Công nghệ phần mềm'		   ,'2005/6/7'  )
INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) VALUES ('MTT' , N'Mạng máy tính và truyền thông','2005/10/20')
INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) VALUES ('KTMT', N'Kỹ thuật máy tính'			   ,'2005/12/20')

INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('THDC'    ,N'Tin học đại cương',					 4, 1, 'KHMT')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('CTRR'    ,N'Cấu trúc rời rạc',						 3, 0, 'KHMT')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('CSDL'    ,N'Cơ sở dữ liệu',						 3, 1, 'HTTT')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('CTDLGT'  ,N'Cấu trúc dữ liệu và giải thuật',		 3, 1, 'KHMT')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('PTTKTT'  ,N'Phân tích thiết kế thuật toán',		 3, 0, 'KHMT')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('DHMT'    ,N'Đồ họa máy tính',						 3, 1, 'KHMT')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('KTMT'    ,N'Kiến trúc máy tính',			   	     3, 0, 'KTMT')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('TKCSDL'  ,N'Thiết kế cơ sở dữ liệu',				 4, 1, 'KHMT')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('PTTKHTTT',N'Phân tích thiết kế hệ thống thông tin', 4, 1, 'KHMT')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('HDH'     ,N'Hệ điều hành',							 4, 1, 'KTMT')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('NMCNPM'  ,N'Nhập môn công nghệ phần mềm',			 3, 0, 'CNPM')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('LTCFW'   ,N'Lập trình C for win',					 3, 0, 'CNPM')
INSERT INTO MONHOC(MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('LTHDT'   ,N'Lập trình hướng đối tượng',			 3, 1, 'CNPM')

INSERT INTO DIEUKIEN(MAMH, MAMH_TRUOC) VALUES ('CSDL'    , 'CTRR'  )
INSERT INTO DIEUKIEN(MAMH, MAMH_TRUOC) VALUES ('CSDL'    , 'CTDLGT')
INSERT INTO DIEUKIEN(MAMH, MAMH_TRUOC) VALUES ('CTDLGT'  , 'THDC'  )
INSERT INTO DIEUKIEN(MAMH, MAMH_TRUOC) VALUES ('PTTKTT'  , 'THDC'  )
INSERT INTO DIEUKIEN(MAMH, MAMH_TRUOC) VALUES ('PTTKTT'  , 'CTDLGT')
INSERT INTO DIEUKIEN(MAMH, MAMH_TRUOC) VALUES ('DHMT'    , 'THDC'  )
INSERT INTO DIEUKIEN(MAMH, MAMH_TRUOC) VALUES ('LTHDT'   , 'THDC'  )
INSERT INTO DIEUKIEN(MAMH, MAMH_TRUOC) VALUES ('PTTKHTTT', 'CSDL'  )
 
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV01', N'Hồ Thanh Sơn'	,'PTS', 'GS'  , N'Nam', '1950/5/2'  , '2004/1/11', 5.00, 2250000, 'KHMT')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV02', N'Trần Tâm Thanh'	,'TS' , 'PGS' , N'Nam', '1965/12/17', '2004/4/20', 4.50, 2025000, 'HTTT')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV03', N'Đỗ Nghiêm Phụng'	,'TS' , 'GS'  , N'Nữ' , '1950/8/1'  , '2004/9/23', 4.00, 1800000, 'CNPM')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV04', N'Trần Nam Sơn'	,'TS' , 'PGS' , N'Nam', '1961/2/22' , '2005/1/12', 4.50, 2025000, 'KTMT')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV05', N'Mai Thanh Danh'	,'ThS', 'GV'  , N'Nam', '1958/3/12' , '2005/1/12', 3.00, 1350000, 'HTTT')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV06', N'Trần Đoàn Hùng'	,'TS' , 'GV'  , N'Nam', '1953/3/11' , '2005/1/12', 4.50, 2025000, 'KHMT')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV07', N'Nguyễn Minh Tiến','ThS', 'GV'  , N'Nam', '1971/11/23', '2005/3/1' , 4.00, 1800000, 'KHMT')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV08', N'Lê Thị Trân'		,'KS' , 'Null', N'Nữ' , '1974/3/26' , '2005/3/1' , 1.69, 760500 , 'KHMT')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV09', N'Nguyễn Tô Lan'	,'ThS', 'GV'  , N'Nữ' , '1966/12/31', '2005/3/1' , 4.00, 1800000, 'HTTT')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV10', N'Lê Trần Anh Loan','KS' , 'Null', N'Nữ' , '1972/7/17' , '2005/3/1' , 1.86, 8370000, 'CNPM')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV11', N'Hồ Thanh Tùng'	,'CN' , 'GV'  , N'Nam', '1980/1/12' , '2005/5/15', 2.67, 1201500, 'MTT' )
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV12', N'Trần Vân Anh'	,'CN' , 'Null', N'Nữ' , '1981/3/29' , '2005/5/15', 1.69, 760500 , 'CNPM')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV13', N'Nguyễn Linh Đan'	,'CN' , 'Null', N'Nữ' , '1980/5/23' , '2005/5/15', 1.69, 760500 , 'KTMT')
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV14', N'Trương Minh Châu','ThS', 'GV'  , N'Nữ' , '1976/11/30', '2005/5/15', 3.00, 1350000, 'MTT' )
INSERT INTO GIAOVIEN(MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV15', N'Lê Hà Thanh'		,'ThS', 'GV'  , N'Nam', '1978/5/4'  , '2005/5/15', 3.00, 1350000, 'KHMT')

INSERT INTO LOP(MALOP, TENLOP, SISO, MAGVCN) VALUES ('K11',N'Lớp 1 khóa 1',11,'GV07')
INSERT INTO LOP(MALOP, TENLOP, SISO, MAGVCN) VALUES ('K12',N'Lớp 2 khóa 1',12,'GV09')
INSERT INTO LOP(MALOP, TENLOP, SISO, MAGVCN) VALUES ('K13',N'Lớp 3 khóa 1',12,'GV14')

INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1101',N'Nguyễn Văn'	   ,N'A'	 ,'1986/1/27', N'Nam' ,N'TpHCM'	    ,'K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1102',N'Trần Ngọc'	   ,N'Hân'   ,'1986/3/14', N'Nữ'  ,N'Kiên Giang','K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1103',N'Hà Duy'		   ,N'Lập'   ,'1986/4/18', N'Nam' ,N'Nghệ An'   ,'K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1104',N'Trần Ngọc' 	   ,N'Linh'  ,'1986/3/30', N'Nữ'  ,N'Tây Ninh'  ,'K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1105',N'Trần Minh'	   ,N'Long'  ,'1986/2/27', N'Nam' ,N'TpHCM'	    ,'K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1106',N'Lệ Nhật'		   ,N'Minh'  ,'1986/1/24', N'Nam' ,N'TpHCM'	    ,'K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1107',N'Nguyễn Như'	   ,N'Nhựt'  ,'1986/1/27', N'Nam' ,N'Hà Nội'    ,'K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1108',N'Nguyễn Mạnh'	   ,N'Tâm'   ,'1986/2/27', N'Nam' ,N'Kiên Giang','K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1109',N'Phan Thị Thanh' ,N'Tâm'   ,'1986/1/27', N'Nữ'  ,N'Vĩnh Long' ,'K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1110',N'Lê Hoài'		   ,N'Thương','1986/2/5' , N'Nữ'  ,N'Cần Thơ'   ,'K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1111',N'Lê Hà'		   ,N'Vinh'  ,'1986/2/25', N'Nam' ,N'Vĩnh Long' ,'K11')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1201',N'Nguyễn Văn'	   ,N'B'	 ,'1986/2/11', N'Nam' ,N'TpHCM'	    ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1202',N'Nguyễn Thị Kim' ,N'Duyên' ,'1986/1/18', N'Nữ'  ,N'TpHCM'	    ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1203',N'Trần Thị Kim'   ,N'Duyên' ,'1986/9/17', N'Nữ'  ,N'TpHCM'	    ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1204',N'Trương Mỹ'	   ,N'Hạnh'  ,'1986/5/19', N'Nữ'  ,N'Đồng Nai'  ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1205',N'Nguyễn Thành'   ,N'Nam'   ,'1986/4/17', N'Nam' ,N'TpHCM'	    ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1206',N'Nguyễn Thị Trúc',N'Thanh' ,'1986/3/4' , N'Nữ'  ,N'Kiên Giang','K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1207',N'Trần Thị Bích'  ,N'Thủy'  ,'1986/2/8' , N'Nữ'  ,N'Nghệ An'   ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1208',N'Huỳnh Thị Kim'  ,N'Triều' ,'1986/4/8' , N'Nữ'  ,N'Tây Ninh'  ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1209',N'Phạm Thanh'	   ,N'Triều' ,'1986/2/23', N'Nam' ,N'TpHCM'	    ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1210',N'Ngô Thanh'	   ,N'Tuấn'  ,'1986/2/14', N'Nam' ,N'TpHCM'	    ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1211',N'Đỗ Thị'		   ,N'Xuân'  ,'1986/3/9' , N'Nữ'  ,N'Hà Nội'    ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1212',N'Lê Thị Phi'	   ,N'Yến'   ,'1986/3/12', N'Nữ'  ,N'TpHCM'	    ,'K12')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1301',N'Nguyễn Thị Kim' ,N'Cúc'   ,'1986/6/9' , N'Nữ'  ,N'Kiên Giang','K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1302',N'Trương Thị Mỹ'  ,N'Hiền'  ,'1986/3/18', N'Nữ'  ,N'Nghệ An'   ,'K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1303',N'Lê Đức'         ,N'Hiền'  ,'1986/3/21', N'Nam' ,N'Tây Ninh'  ,'K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1304',N'Lê Quang'	   ,N'Hiền'  ,'1986/4/18', N'Nam' ,N'TpHCM'	    ,'K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1305',N'Lê Thị'         ,N'Hương' ,'1986/3/27', N'Nữ'  ,N'TpHCM'	    ,'K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1306',N'Nguyễn Thái'	   ,N'Hữu'   ,'1986/3/30', N'Nam' ,N'Hà Nội'    ,'K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1307',N'Trần Minh'	   ,N'Mẫn'   ,'1986/5/28', N'Nam' ,N'TpHCM'	    ,'K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1308',N'Nguyễn Hiếu'	   ,N'Nghĩa' ,'1986/4/8' , N'Nam' ,N'Kiên Giang','K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1309',N'Nguyễn Trung'   ,N'Nghĩa' ,'1987/1/18', N'Nam' ,N'Nghệ An'   ,'K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1310',N'Trần Thị Hồng'  ,N'Thắm'  ,'1986/4/22', N'Nữ'  ,N'Tây Ninh'  ,'K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1311',N'Trần Minh'      ,N'Thức'  ,'1986/4/4' , N'Nam' ,N'TpHCM'	    ,'K13')
INSERT INTO HOCVIEN(MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1312',N'Nguyễn Thị Kim' ,N'Yến'   ,'1986/9/7' , N'Nữ'  ,N'TpHCM'	    ,'K13')

INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11','THDC'  ,'GV07',1,2006,'2006/1/2' ,'2006/5/12' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K12','THDC'  ,'GV06',1,2006,'2006/1/2' ,'2006/5/12' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K13','THDC'  ,'GV15',1,2006,'2006/1/2' ,'2006/5/12' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11','CTRR'  ,'GV02',1,2006,'2006/1/9' ,'2006/5/17' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K12','CTRR'  ,'GV02',1,2006,'2006/1/9' ,'2006/5/17' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K13','CTRR'  ,'GV08',1,2006,'2006/1/9' ,'2006/5/17' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11','CSDL'  ,'GV05',1,2006,'2006/6/1' ,'2006/7/15' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K12','CSDL'  ,'GV09',2,2006,'2006/6/1' ,'2006/7/15' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K13','CTDLGT','GV15',2,2006,'2006/6/1' ,'2006/7/15' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K13','CSDL'  ,'GV05',3,2006,'2006/8/1' ,'2006/12/15')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K13','DHMT'  ,'GV07',3,2006,'2006/8/1' ,'2006/12/15')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11','CTDLGT','GV15',3,2006,'2006/8/1' ,'2006/12/15')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K12','CTDLGT','GV15',3,2006,'2006/8/1' ,'2006/12/15')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11','HDH'   ,'GV04',1,2007,'2007/1/2' ,'2007/2/18' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K12','HDH'   ,'GV04',1,2007,'2007/1/2' ,'2007/3/20' )
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11','DHMT'  ,'GV07',1,2007,'2007/2/18','2007/3/20' )

INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1101','CSDL'  , 1,'2006/7/20' , 10.00,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1101','CTDLGT', 1,'2006/12/28', 9.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1101','THDC'  , 1,'2006/5/20' , 9.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1101','CTRR'  , 1,'2006/5/13' , 9.50 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102','CSDL'  , 1,'2006/7/20' , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102','CSDL'  , 2,'2006/7/27' , 4.25 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102','CSDL'  , 3,'2006/8/10' , 4.50 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102','CTDLGT', 1,'2006/12/28', 4.50 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102','CTDLGT', 2,'2007/1/5'  , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102','CTDLGT', 3,'2007/1/15' , 6.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102','THDC'  , 1,'2006/5/20' , 5.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102','CTRR'  , 1,'2006/5/13' , 7.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1103','CSDL'  , 1,'2006/7/20' , 3.50 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1103','CSDL'  , 2,'2006/7/27' , 8.25 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1103','CTDLGT', 1,'2006/12/28', 7.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1103','THDC'  , 1,'2006/5/20' , 8.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1103','CTRR'  , 1,'2006/5/13' , 6.50 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104','CSDL'  , 1,'2006/7/20' , 3.75 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104','CTDLGT', 1,'2006/12/28', 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104','THDC'  , 1,'2006/5/20' , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104','CTRR'  , 1,'2006/5/13' , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104','CTRR'  , 2,'2006/5/20' , 3.50 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104','CTRR'  , 3,'2006/6/30' , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1201','CSDL'  , 1,'2006/7/20' , 6.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1201','CTDLGT', 1,'2006/12/28', 5.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1201','THDC'  , 1,'2006/5/20' , 8.50 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1201','CTRR'  , 1,'2006/5/13' , 9.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202','CSDL'  , 1,'2006/7/20' , 8.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202','CTDLGT', 1,'2006/12/28', 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202','CTDLGT', 2,'2007/1/5'  , 5.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202','THDC'  , 1,'2006/5/20' , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202','THDC'  , 2,'2006/5/27' , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202','CTRR'  , 1,'2006/5/13' , 3.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202','CTRR'  , 2,'2006/5/20' , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202','CTRR'  , 3,'2006/6/30' , 6.25 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1203','CSDL'  , 1,'2006/7/20' , 9.25 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1203','CTDLGT', 1,'2006/12/28', 9.50 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1203','THDC'  , 1,'2006/5/20' , 10.00,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1203','CTRR'  , 1,'2006/5/13' , 10.00,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1204','CSDL'  , 1,'2006/7/20' , 8.50 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1204','CTDLGT', 1,'2006/12/28', 6.75 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1204','THDC'  , 1,'2006/5/20' , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1204','CTRR'  , 1,'2006/5/13' , 6.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1301','CSDL'  , 1,'2006/7/20' , 4.25 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1301','CTDLGT', 1,'2006/12/28', 8.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1301','THDC'  , 1,'2006/5/20' , 7.75 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1301','CTRR'  , 1,'2006/5/13' , 8.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1302','CSDL'  , 1,'2006/12/20', 6.75 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1302','CTDLGT', 1,'2006/7/25' , 5.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1302','THDC'  , 1,'2006/5/20' , 8.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1302','CTRR'  , 1,'2006/5/13' , 8.50 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303','CSDL'  , 1,'2006/7/20' , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303','CTDLGT', 1,'2006/7/25' , 4.50 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303','CTDLGT', 2,'2007/8/7'  , 4.00 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303','CTDLGT', 3,'2006/8/15' , 4.25 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303','THDC'  , 1,'2006/5/20' , 4.50 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303','CTRR'  , 1,'2006/5/13' , 3.25 ,N'Không Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303','CTRR'  , 2,'2006/5/20' , 5.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1304','CSDL'  , 1,'2006/12/20', 7.75 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1304','CTDLGT', 1,'2006/7/25' , 9.75 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1304','THDC'  , 1,'2006/5/20' , 5.50 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1304','CTRR'  , 1,'2006/5/13' , 5.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1305','CSDL'  , 1,'2006/12/20', 9.25 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1305','CTDLGT', 1,'2006/7/25' , 10.00,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1305','THDC'  , 1,'2006/5/20' , 8.00 ,N'Đạt')
INSERT INTO KETQUATHI(MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1305','CTRR'  , 1,'2006/5/13' , 10.00,N'Đạt')

UPDATE KHOA 
SET TRGKHOA = 'GV01' 
WHERE MAKHOA = 'KHMT'
UPDATE KHOA 
SET TRGKHOA = 'GV02' 
WHERE MAKHOA = 'HTTT'
UPDATE KHOA 
SET TRGKHOA = 'GV03' 
WHERE MAKHOA = 'MTT'
UPDATE KHOA 
SET TRGKHOA = 'GV04' 
WHERE MAKHOA = 'CNPM'

UPDATE LOP 
SET TRGLOP = 'K1108'
WHERE MALOP = 'K11'
UPDATE LOP 
SET TRGLOP = 'K1205'
WHERE MALOP = 'K12'
UPDATE LOP 
SET TRGLOP = 'K1305'
WHERE MALOP = 'K13'

SELECT* FROM KHOA
SELECT* FROM GIAOVIEN
SELECT* FROM HOCVIEN 
SELECT* FROM GIANGDAY
SELECT* FROM DIEUKIEN
SELECT* FROM KETQUATHI 
SELECT* FROM LOP
SELECT* FROM MONHOC 

--------------------------------------------------------------------------------------------------------------------------
--II> NGÔN NGỮ THAO TÁC DỮ LIỆU (DATA MANIPULATION LANGUAGE):
--1> Tăng hệ số lương thêm 0.2 cho những giáo viên là trưởng khoa.
--Cách 1>
UPDATE GIAOVIEN 
SET HESO = HESO + 0.2 
WHERE MAGV IN ( SELECT TRGKHOA FROM KHOA )
--Cách 2>
UPDATE GIAOVIEN 
SET HESO = HESO + 0.2 
WHERE EXISTS ( SELECT MAGV 
			   FROM KHOA 
			   WHERE GIAOVIEN.MAGV = KHOA.TRGKHOA )

--2> Cập nhật giá trị điểm trung bình tất cả các môn học (DIEMTB) của mỗi học viên 
--(tất cả các môn học đều có hệ số 1 và nếu học viên thi một môn nhiều lần, chỉ lấy 
--điểm của lần thi sau cùng).
SELECT *FROM HOCVIEN 
SELECT *FROM KETQUATHI

UPDATE HOCVIEN
SET DIEMTB = (SELECT AVG(DIEM)
              FROM KETQUATHI KQ1
              WHERE LANTHI = (SELECT MAX(LANTHI)
                              FROM KETQUATHI KQ2
                              WHERE (KQ1.MAHV = KQ2.MAHV AND KQ1.MAMH = KQ2.MAMH)
                              GROUP BY MAHV,MAMH)
              GROUP BY MAHV
              HAVING MAHV = HOCVIEN.MAHV)

--3> Cập nhật giá trị cho cột GHICHU là “Cam thi” đối với trường hợp: học viên có một môn bất kỳ thi lần thứ 3 dưới 5 điểm.
SELECT *FROM HOCVIEN 
-- Cách 1>
UPDATE HOCVIEN
SET GHICHU = N'Cấm thi'
WHERE MAHV IN(SELECT MAHV 
			  FROM KETQUATHI 
			  WHERE LANTHI=3 AND DIEM <5)
--Cách 2> 
UPDATE HOCVIEN
SET GHICHU = N'Cấm thi'
WHERE EXISTS (SELECT MAHV 
			  FROM KETQUATHI 
			  WHERE HOCVIEN.MAHV = KETQUATHI.MAHV AND LANTHI=3 AND DIEM <5 ) 

--4> Cập nhật giá trị cho cột XEPLOAI trong quan hệ HOCVIEN 
UPDATE HOCVIEN
SET XEPLOAI ='XS'
WHERE DIEMTB >=9

UPDATE HOCVIEN
SET XEPLOAI = 'G'
WHERE DIEMTB >=8 AND DIEMTB <9

UPDATE HOCVIEN 
SET XEPLOAI ='K'
WHERE DIEMTB >=6.5 AND DIEMTB <8

UPDATE HOCVIEN
SET XEPLOAI = 'TB'
WHERE DIEMTB >=5 AND DIEMTB <6.5

UPDATE HOCVIEN
SET XEPLOAI ='Y'
WHERE DIEMTB <5 
--------------------------------------------------------------------------------------------------------------------------
--III> NGÔN NGỮ TRUY VẤN DỮ LIỆU 
--1> In ra danh sách (mã học viên, họ tên, ngày sinh, mã lớp) lớp trưởng của các lớp.
SELECT TRGLOP,CONCAT(HO,' ',TEN) AS HOTEN, NGSINH, LOP.MALOP
FROM HOCVIEN 
INNER JOIN LOP ON HOCVIEN.MAHV = LOP.TRGLOP

--2> In ra bảng điểm khi thi (mã học viên, họ tên , lần thi, điểm số) môn CTRR của lớp “K12”, sắp xếp theo tên, họ học viên
SELECT HOCVIEN.MAHV, CONCAT(HO,' ',TEN) AS HOTEN, LANTHI, DIEM
FROM KETQUATHI 
INNER JOIN HOCVIEN ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE MAMH = 'CTRR' AND MALOP = 'K12'
ORDER BY HOTEN 

--3> In ra danh sách những học viên (mã học viên, họ tên) và những môn học mà học viên đó thi lần thứ nhất đã đạt.
SELECT HOCVIEN.MAHV , CONCAT(HO,' ',TEN) AS HOTEN,MONHOC.MAMH, MONHOC.TENMH
FROM KETQUATHI
INNER JOIN HOCVIEN ON HOCVIEN.MAHV = KETQUATHI.MAHV
INNER JOIN MONHOC ON MONHOC.MAMH = KETQUATHI.MAMH 
WHERE LANTHI = 1 AND DIEM>=5
ORDER BY MAHV 

--4> In ra danh sách học viên (mã học viên, họ tên) của lớp “K11” thi môn CTRR không đạt (ở lần thi 1).
SELECT HOCVIEN.MAHV, CONCAT(HO,' ',TEN) AS HOTEN 
FROM KETQUATHI 
INNER JOIN HOCVIEN ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE MAMH = 'CTRR' AND MALOP = 'K11' AND DIEM < 5 AND LANTHI = 1

------------------------------------------------------------BUỔI 3--------------------------------------------------------
--5-18 phần III
--5. Danh sách học viên (mã học viên, họ tên) của lớp “K” thi môn CTRR không đạt (ở tất cả các lần thi)
--Cách 1>
SELECT DISTINCT HOCVIEN.MAHV,CONCAT(HO,' ',TEN) AS HOTEN
FROM HOCVIEN 
INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV 
WHERE KETQUATHI.MAHV <> ALL(SELECT MAHV 
							FROM KETQUATHI
							WHERE KQUA = N'Đạt') 
	  AND MAMH = 'CTRR' AND SUBSTRING(HOCVIEN.MALOP, 1, 1) ='K' 

--Cách 2>
SELECT HOCVIEN.MAHV, CONCAT(HO,' ',TEN) AS HOTEN 
FROM HOCVIEN 
WHERE HOCVIEN.MAHV IN (SELECT DISTINCT MAHV 
					   FROM KETQUATHI 
					   WHERE MAMH = 'CTRR' AND DIEM < 5
					   EXCEPT
					   SELECT DISTINCT MAHV 
					   FROM KETQUATHI 
					   WHERE MAMH = 'CTRR' AND DIEM >= 5)

--6> Tìm tên những môn học mà giáo viên có tên “Trần Tâm Thanh” dạy trong học kỳ 1 năm 2006
SELECT DISTINCT TENMH 
FROM MONHOC
INNER JOIN GIANGDAY ON MONHOC.MAMH = GIANGDAY.MAMH
INNER JOIN GIAOVIEN ON GIANGDAY.MAGV = GIAOVIEN.MAGV 
WHERE GIAOVIEN.HOTEN = N'Trần Tâm Thanh' AND HOCKY = 1 AND NAM = 2006 

--7> Tìm những môn học (mã môn học, tên môn học) mà giáo viên chủ nhiệm lớp “K11” dạy trong học kỳ 1 năm 2006
--Cách 1>
SELECT DISTINCT MONHOC.MAMH, TENMH
FROM MONHOC
INNER JOIN GIANGDAY ON MONHOC.MAMH = GIANGDAY.MAMH
WHERE MAGV IN ( SELECT MAGVCN FROM LOP 
			   WHERE MALOP = 'K11'
			   AND HOCKY = 1
			   AND NAM = 2006)

--Cách 2> 
SELECT DISTINCT MONHOC.MAMH, TENMH
FROM MONHOC
INNER JOIN GIANGDAY ON MONHOC.MAMH = GIANGDAY.MAMH
INNER JOIN LOP ON LOP.MALOP = GIANGDAY.MALOP
WHERE MAGV = MAGVCN 
	  AND HOCKY = 1 
	  AND NAM = 2006

--8> Tìm họ tên lớp trưởng của các lớp mà giáo viên có tên “Nguyễn Tô Lan” dạy môn “Cơ sở dữ liệu”
SELECT CONCAT(HO,' ',TEN) AS HOTEN 
FROM HOCVIEN 
INNER JOIN LOP ON LOP.MALOP = HOCVIEN.MALOP
INNER JOIN GIANGDAY ON LOP.MALOP = GIANGDAY.MALOP
INNER JOIN MONHOC ON MONHOC.MAMH = GIANGDAY.MAMH
INNER JOIN GIAOVIEN ON GIAOVIEN.MAGV = GIANGDAY.MAGV 
WHERE MAHV = TRGLOP
	  AND GIAOVIEN.HOTEN = N'Nguyễn Tô Lan' 
	  AND TENMH = N'Cơ sở dữ liệu'

--9> In ra danh sách những môn học (mã môn học, tên môn học) phải học liền trước môn “Cơ sở dữ liệu”.
SELECT MONHOC.MAMH, TENMH 
FROM MONHOC
WHERE MAMH IN (SELECT DIEUKIEN.MAMH_TRUOC
			   FROM DIEUKIEN 
			   INNER JOIN MONHOC ON MONHOC.MAMH = DIEUKIEN.MAMH
			   WHERE TENMH = N'Cơ sở dữ liệu')

--10> Môn “Cấu trúc rời rạc” là môn bắt buộc phải học liền trước những môn học (mã môn học, tên môn học) nào.
SELECT MONHOC.MAMH, TENMH
FROM DIEUKIEN 
INNER JOIN MONHOC ON MONHOC.MAMH = DIEUKIEN.MAMH
WHERE MAMH_TRUOC IN ( SELECT MAMH 
					 FROM MONHOC 
					 WHERE TENMH = N'Cấu trúc rời rạc')

--11> Tìm họ tên giáo viên dạy môn CTRR cho cả hai lớp “K11” và “K12” trong cùng học kỳ 1 năm 2006
--Cách 1>
SELECT HOTEN 
FROM GIAOVIEN 
WHERE MAGV IN (SELECT MAGV FROM GIANGDAY 
			   WHERE MAMH = 'CTRR' AND HOCKY = 1 AND NAM = 2006 AND MALOP = 'K11'
			   UNION 
			   SELECT MAGV FROM GIANGDAY 
			   WHERE MAMH = 'CTRR' AND HOCKY = 1 AND NAM = 2006 AND MALOP = 'K12')

--Cách 2> 
SELECT DISTINCT HOTEN 
FROM GIAOVIEN 
INNER JOIN GIANGDAY ON GIANGDAY.MAGV = GIAOVIEN.MAGV 
WHERE MAMH = 'CTRR' AND HOCKY = 1 AND NAM = 2006 AND (MALOP = 'K11' OR MALOP ='K12')

--12> Tìm những học viên (mã học viên, họ tên) thi không đạt môn CSDL ở lần thi thứ 1 nhưng chưa thi lại môn này.
SELECT MAHV, CONCAT(HO,' ',TEN) AS HOTEN
FROM HOCVIEN
WHERE MAHV IN (SELECT MAHV FROM KETQUATHI 
			  WHERE MAMH = 'CSDL' AND LANTHI = 1 AND KQUA = N'Không Đạt'
			  EXCEPT
			  SELECT MAHV FROM KETQUATHI	
		      WHERE LANTHI>1 AND MAMH ='CSDL')

--13> Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào.
--Cách 1>
SELECT MAGV, HOTEN 
FROM GIAOVIEN 
EXCEPT 
SELECT GIANGDAY.MAGV, HOTEN 
FROM GIANGDAY 
INNER JOIN GIAOVIEN ON GIAOVIEN.MAGV = GIANGDAY.MAGV

--Cách 2>
SELECT MAGV, HOTEN 
FROM GIAOVIEN 
WHERE NOT EXISTS (SELECT* FROM GIANGDAY 
				  WHERE MAGV = GIAOVIEN.MAGV )

--14> Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào thuộc khoa giáo viên đó phụ trách.
SELECT GIAOVIEN.MAGV, HOTEN 
FROM GIAOVIEN 
INNER JOIN GIANGDAY ON GIANGDAY.MAGV = GIAOVIEN.MAGV 
INNER JOIN MONHOC ON MONHOC.MAMH = GIANGDAY.MAMH 
WHERE MONHOC.MAKHOA != GIAOVIEN.MAKHOA
UNION
SELECT MAGV,HOTEN
FROM GIAOVIEN
WHERE NOT EXISTS (
		SELECT* FROM GIANGDAY 
		WHERE GIAOVIEN.MAGV = MAGV)


--15> Tìm họ tên các học viên thuộc lớp “K11” thi một môn bất kỳ quá 3 lần vẫn “Khong dat” hoặc thi lần thứ 2 môn CTRR được 5 điểm.
-- Cách 1>
SELECT DISTINCT CONCAT(HO,' ',TEN) AS HOTEN
FROM HOCVIEN
WHERE MAHV IN (SELECT MAHV FROM KETQUATHI WHERE LANTHI = 3 AND KQUA = N'Không Đạt'
	           UNION 
			   SELECT MAHV FROM KETQUATHI WHERE LANTHI = 2 AND MAMH = 'CTRR' AND DIEM = 5)
	  AND MALOP = 'K11'

-- Cách 2> 
SELECT DISTINCT CONCAT(HO,' ',TEN) AS HOTEN 
FROM HOCVIEN 
INNER JOIN KETQUATHI ON KETQUATHI.MAHV = HOCVIEN.MAHV 
WHERE MALOP = 'K11' AND 
	((LANTHI = 3 AND KQUA = N'Không Đạt') 
	  OR 
	 (LANTHI = 2 AND MAMH = 'CTRR' AND DIEM = 5))

--16> Tìm họ tên giáo viên dạy môn CTRR cho ít nhất hai lớp trong cùng một học kỳ của một năm học.
SELECT DISTINCT HOTEN 
FROM GIAOVIEN 
INNER JOIN GIANGDAY ON GIANGDAY.MAGV = GIAOVIEN.MAGV 
WHERE GIAOVIEN.MAGV IN (SELECT MAGV 
						FROM GIANGDAY 
						GROUP BY MAGV,HOCKY,NAM 
						HAVING COUNT(MAGV) > 1) 
	  AND MAMH = 'CTRR'

--17> Danh sách học viên và điểm thi môn CSDL (chỉ lấy điểm của lần thi sau cùng).
SELECT HOCVIEN.MAHV,CONCAT(HO,' ',TEN) AS HOTEN,DIEM
FROM KETQUATHI KQ1
INNER JOIN HOCVIEN ON HOCVIEN.MAHV = KQ1.MAHV 
WHERE LANTHI = (SELECT MAX(LANTHI)
                FROM KETQUATHI KQ2
                WHERE (KQ1.MAHV = KQ2.MAHV AND KQ1.MAMH = KQ2.MAMH)
                GROUP BY MAHV,MAMH) 
	  AND MAMH = 'CSDL'
ORDER BY HOCVIEN.MAHV 

--18> Danh sách học viên và điểm thi môn “Cơ sở dữ liệu” (chỉ lấy điểm cao nhất của các lần thi)
SELECT HOCVIEN.MAHV,CONCAT(HO,' ',TEN) AS HOTEN,DIEM
FROM KETQUATHI KQ1
INNER JOIN HOCVIEN ON HOCVIEN.MAHV = KQ1.MAHV 
INNER JOIN MONHOC ON KQ1.MAMH = MONHOC.MAMH 
WHERE DIEM = (SELECT MAX(DIEM)
              FROM KETQUATHI KQ2
              WHERE (KQ1.MAHV = KQ2.MAHV AND KQ1.MAMH = KQ2.MAMH)
              GROUP BY MAHV,MAMH) 
	  AND TENMH = N'Cơ sở dữ liệu'
ORDER BY HOCVIEN.MAHV 

------------------------------------------------------------BUỔI 4--------------------------------------------------------
-- 19->35 

--19> Khoa nào (mã khoa, tên khoa) được thành lập sớm nhất.
SELECT MAKHOA, TENKHOA
FROM KHOA
WHERE NGTLAP = ( SELECT MIN(NGTLAP)
				 FROM KHOA)

--20> Có bao nhiêu giáo viên có học hàm là “GS” hoặc “PGS”.
SELECT HOCHAM, COUNT(MAGV) AS SOLUONG
FROM GIAOVIEN
WHERE HOCHAM = 'GS' OR HOCHAM = 'PGS'
GROUP BY HOCHAM
--20.1> Số giáo viên không phải GS hoặc PGS 
SELECT COUNT(*) AS SOLUONG
FROM GIAOVIEN
WHERE HOCHAM NOT IN ('GS','PGS') 

--21> Thống kê có bao nhiêu giáo viên có học vị là “CN”, “KS”, “Ths”, “TS”, “PTS” trong mỗi khoa.
SELECT MAKHOA,HOCVI, COUNT(*) AS SOLUONG 
FROM GIAOVIEN 
GROUP BY MAKHOA, HOCVI 
ORDER BY MAKHOA 
--21.1> Coi TS và PTS là 1: 
SELECT*
FROM GIAOVIEN 


--21.2> Cập nhật  
UPDATE GIAOVIEN 
SET HOCVI = 'TSKH' 
WHERE HOCVI = 'TS' 
UPDATE GIAOVIEN
SET HOCVI = 'TS'
WHERE HOCVI = 'PTS' 
SELECT*
FROM GIAOVIEN 

--21.3> 'CN' : 15, 'KS' : 15, 'Ths' : 22, 'TS' : 30
-- 'PGS' : 40, 'GS': 60

--22> Mỗi môn học thống kê số lượng học viên theo kết quả (đạt và không đạt).
SELECT TENMH,KQUA, COUNT(*) AS SOLUONG 
FROM KETQUATHI 
INNER JOIN MONHOC ON MONHOC.MAMH = KETQUATHI.MAMH 
GROUP BY MONHOC.TENMH, KQUA 
ORDER BY MONHOC.TENMH 

--22.1 Theo lớp 
SELECT LOP.MALOP, TENMH, KQUA, COUNT(*) AS SOLUONG 
FROM KETQUATHI 
INNER JOIN MONHOC ON MONHOC.MAMH = KETQUATHI.MAMH 
INNER JOIN HOCVIEN ON HOCVIEN.MAHV = KETQUATHI.MAHV 
INNER JOIN LOP ON LOP.MALOP = HOCVIEN.MALOP 
GROUP BY MONHOC.TENMH, KQUA,LOP.MALOP  
ORDER BY MALOP,MONHOC.TENMH  

--23> Tìm giáo viên (mã giáo viên, họ tên) là giáo viên chủ nhiệm của một lớp, đồng thời dạy cho lớp đó ít nhất một môn học.
SELECT HOTEN,MAGV 
FROM GIAOVIEN 
WHERE MAGV IN( SELECT MAGVCN 
			   FROM LOP 
			   WHERE EXISTS( SELECT* 
							 FROM GIANGDAY 
						     WHERE MAGVCN = GIANGDAY.MAGV))

--24> Tìm họ tên lớp trưởng của lớp có sỉ số cao nhất.
--Cách 1> 
SELECT CONCAT(HO,' ',TEN) AS HOTEN
FROM HOCVIEN 
INNER JOIN LOP ON LOP.MALOP = HOCVIEN.MALOP
WHERE TRGLOP = HOCVIEN.MAHV 
	  AND LOP.SISO = (SELECT MAX(SISO) 
	                  FROM LOP) 

--Cách 2>
SELECT CONCAT(HO,' ',TEN) AS HOTEN
FROM HOCVIEN 
WHERE MAHV IN (SELECT TRGLOP 
			   FROM LOP 
			   WHERE SISO = (SELECT MAX(SISO) 
							 FROM LOP ))

--25> * Tìm họ tên những LOPTRG thi không đạt quá 3 môn (mỗi môn đều thi không đạt ở tất cả các lần thi)
SELECT CONCAT(HO,' ',TEN) AS HOTEN 
FROM HOCVIEN 
INNER JOIN LOP ON LOP.MALOP = HOCVIEN.MALOP
WHERE TRGLOP IN (SELECT MAHV
				 FROM (SELECT MAHV, MAMH
					   FROM KETQUATHI 
					   WHERE KQUA = N'Không Đạt' 
					   EXCEPT 
					   SELECT MAHV, MAMH 
					   FROM KETQUATHI 
					   WHERE KQUA = N'Đạt' AND LANTHI > 1) AS L
				 GROUP BY MAHV 
				 HAVING COUNT(MAMH) > 3)

--26> Tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9,10 nhiều nhất.
SELECT HOCVIEN.MAHV,CONCAT(HO,' ',TEN) AS HOTEN, COUNT(HOCVIEN.MAHV) AS SO_LUONG
FROM KETQUATHI 
INNER JOIN HOCVIEN ON HOCVIEN.MAHV = KETQUATHI.MAHV 
WHERE DIEM BETWEEN 9 AND 10 
GROUP BY HOCVIEN.MAHV,HO,TEN 
HAVING COUNT(DIEM) = ( SELECT MAX(SOLUONG) 
					   FROM( SELECT MAHV, COUNT(MAHV) AS SOLUONG 
							 FROM KETQUATHI 
							 WHERE DIEM BETWEEN 9 AND 10 
							 GROUP BY MAHV) AS A)

--27> Trong từng lớp, tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9,10 nhiều nhất.
SELECT DISTINCT HOCVIEN.MAHV, CONCAT(HO,' ',TEN) AS HOTEN, SOLUONG 
FROM ( SELECT MAHV, COUNT(MAHV) AS SOLUONG 
	   FROM KETQUATHI
	   WHERE DIEM BETWEEN 9 AND 10
	   GROUP BY MAHV) AS A, --Bảng A: Số lượng 9 10 của từng sinh viên 

	 ( SELECT MALOP, MAX(SOLUONG) AS SL
	   FROM (SELECT MAHV, COUNT(MAHV) AS SOLUONG 
			 FROM KETQUATHI 							 
			 WHERE DIEM BETWEEN 9 AND 10 
			 GROUP BY MAHV) AS A
			 INNER JOIN HOCVIEN ON HOCVIEN.MAHV = A.MAHV 
	   GROUP BY MALOP) AS B, --Bảng B: Số lượng 9 10 nhiều nhất trong từng lớp 
	 HOCVIEN 
WHERE A.SOLUONG = B.SL AND A.MAHV = HOCVIEN.MAHV

--28> Trong từng học kỳ của từng năm, mỗi giáo viên phân công dạy bao nhiêu môn học, bao nhiêu lớp.
SELECT GIAOVIEN.MAGV, HOTEN, HOCKY, NAM, COUNT(DISTINCT MAMH) AS SL_MONHOC, COUNT(DISTINCT MALOP) AS SL_LOP 
FROM GIAOVIEN,GIANGDAY  
WHERE GIAOVIEN.MAGV = GIANGDAY.MAGV 
GROUP BY HOCKY, NAM,GIAOVIEN.MAGV,HOTEN 
ORDER BY HOCKY, NAM 

--29> Trong từng học kỳ của từng năm, tìm giáo viên (mã giáo viên, họ tên) giảng dạy nhiều nhất.
SELECT GIAOVIEN.MAGV, HOTEN, A.HOCKY, A.NAM, A.SLGD  
FROM (SELECT HOCKY, NAM, MAX(SL_GIANGDAY) AS SLGD
	  FROM( SELECT MAGV,HOCKY,NAM, COUNT(MAGV) AS SL_GIANGDAY 
		    FROM GIANGDAY 
		    GROUP BY MAGV, HOCKY, NAM) AS BANGMOI 
	  GROUP BY HOCKY,NAM
	 ) AS A, -- Bảng A: Số lượng giảng dạy nhiều nhất trong từng học kì 
	 (SELECT MAGV,HOCKY,NAM, COUNT(MAGV) AS SL_GIANGDAY 
	  FROM GIANGDAY 
	  GROUP BY MAGV, HOCKY, NAM 
	 ) AS B, -- Bảng B: Trong từng học kì, năm, số lần giảng dạy của từng giáo viên 
	  GIAOVIEN
WHERE A.HOCKY = B.HOCKY AND A.NAM = B.NAM AND A.SLGD = B.SL_GIANGDAY AND GIAOVIEN.MAGV = B.MAGV
ORDER BY A.NAM, A.HOCKY		

--30> Tìm môn học (mã môn học, tên môn học) có nhiều học viên thi không đạt (ở lần thi thứ 1) nhất.
SELECT KQ.MAMH, TENMH, COUNT(KQ.MAHV) AS SL 
FROM KETQUATHI KQ, MONHOC MH 
WHERE KQ.MAMH = MH.MAMH AND KQUA = N'Không Đạt' AND LANTHI = 1 
GROUP BY KQ.MAMH,TENMH 
HAVING COUNT(KQ.MAHV) >=ALL (SELECT COUNT(MAHV) -- >= ALL: lớn nhất 
						     FROM KETQUATHI
						     WHERE KQUA = N'Không Đạt' AND LANTHI = 1 
						     GROUP BY MAMH)

--31> Tìm học viên (mã học viên, họ tên) thi môn nào cũng đạt (chỉ xét lần thi thứ 1).
SELECT HOCVIEN.MAHV, CONCAT(HO,' ',TEN) AS HOTEN 
FROM(SELECT MAHV
	 FROM KETQUATHI 
	 WHERE LANTHI = 1 AND KQUA = N'Đạt'
	 GROUP BY MAHV
	 HAVING COUNT(MAHV) = 4) AS A
INNER JOIN HOCVIEN ON HOCVIEN.MAHV = A.MAHV 

--32> * Tìm học viên (mã học viên, họ tên) thi môn nào cũng đạt (chỉ xét lần thi sau cùng).
SELECT HOCVIEN.MAHV, CONCAT(HO,' ',TEN) AS HOTEN 
FROM HOCVIEN, (SELECT MAHV, COUNT(MAHV) AS SL_QUAMON 
			   FROM KETQUATHI KQ1
			   WHERE LANTHI = (SELECT MAX(LANTHI) -- Lấy lần thi sau cùng 
                               FROM KETQUATHI KQ2
						       WHERE (KQ1.MAHV = KQ2.MAHV AND KQ1.MAMH = KQ2.MAMH)
						       GROUP BY MAHV,MAMH) 
			    	 AND KQUA = N'Đạt'
			   GROUP BY MAHV) AS A -- Bảng A lấy ra từng học viên và số môn đạt 
WHERE HOCVIEN.MAHV = A.MAHV AND SL_QUAMON = 4

--33> * Tìm học viên (mã học viên, họ tên) đã thi tất cả các môn đều đạt (chỉ xét lần thi thứ 1).
-- Phép chia 
-- Bảng HOCVIEN, MONHOC, KETQUATHI 
SELECT HOCVIEN.MAHV, CONCAT(HO,' ',TEN) AS HOTEN 
FROM HOCVIEN 
WHERE NOT EXISTS(SELECT*
				 FROM MONHOC 
				 WHERE NOT EXISTS(SELECT* 
								  FROM KETQUATHI
								  WHERE KETQUATHI.MAMH = MONHOC.MAMH 
								        AND KETQUATHI.MAHV = HOCVIEN.MAHV 
										AND KQUA = N'Đạt'
										AND LANTHI = 1))
--34> * Tìm học viên (mã học viên, họ tên) đã thi tất cả các môn đều đạt (chỉ xét lần thi sau cùng).
-- Phép chia 
-- Bảng HOCVIEN, MONHOC, KETQUATHI 
SELECT HOCVIEN.MAHV, CONCAT(HO,' ',TEN) AS HOTEN 
FROM HOCVIEN 
WHERE NOT EXISTS(SELECT*
				 FROM MONHOC 
				 WHERE NOT EXISTS(SELECT* 
								  FROM KETQUATHI KQ1
								  WHERE KQ1.MAMH = MONHOC.MAMH 
								        AND KQ1.MAHV = HOCVIEN.MAHV 
										AND KQUA = N'Đạt'
										AND LANTHI =(SELECT MAX(LANTHI) -- Lấy ra lần thi sau cùng 
												     FROM KETQUATHI KQ2
													 WHERE (KQ1.MAHV = KQ2.MAHV 
												            AND KQ1.MAMH = KQ2.MAMH))))
--35> ** Tìm học viên (mã học viên, họ tên) có điểm thi cao nhất trong từng môn (lấy điểm ở lần thi sau cùng)
SELECT HOCVIEN.MAHV,CONCAT(HO, ' ',TEN) AS HOTEN,KQ4.MAMH,DIEM  -- In ra điểm tất cả lần thi cuối 
FROM KETQUATHI KQ4,HOCVIEN, (SELECT MAMH, MAX(DIEM) AS DIEMCAONHAT -- Điểm cao nhất của từng môn lần thi cuối 
							 FROM ( SELECT MAHV,MAMH ,LANTHI,DIEM   
									FROM KETQUATHI KQ1
									WHERE LANTHI = (SELECT MAX(LANTHI)
													FROM KETQUATHI KQ2
				   									WHERE (KQ1.MAHV = KQ2.MAHV AND KQ1.MAMH = KQ2.MAMH)
													GROUP BY MAHV,MAMH
													)
								   ) AS A, HOCVIEN --Bảng A lọc ra điểm tất cả lần thi cuối
							 WHERE HOCVIEN.MAHV = A.MAHV
							 GROUP BY MAMH
							) AS C -- Bảng C lọc ra điểm cao nhất của từng môn lần thi cuối 
WHERE LANTHI = (SELECT MAX(LANTHI) -- Lần thi cuối 
			    FROM KETQUATHI KQ5
				WHERE (KQ4.MAHV = KQ5.MAHV AND KQ4.MAMH = KQ5.MAMH)
				GROUP BY MAHV,MAMH
			    )
	  AND KQ4.MAMH = C.MAMH AND KQ4.DIEM = C.DIEMCAONHAT -- Học viên có môn học và điểm trùng với bảng C
	  AND HOCVIEN.MAHV = KQ4.MAHV